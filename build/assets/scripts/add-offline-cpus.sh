#!/usr/bin/bash                                                                                                                                                            
                                                                                                                                                                            
set -euo pipefail                                                                                                                                                          
                                                                                                                                                                           
disable_cpu=0                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                           
if [[ $OFFLINE_CORES =~ "-" ]]; then                                                                                                                                                                                                                                                                                                                       
  range_cpus="$(echo $OFFLINE_CORES | grep -o -E '[0-9]+')"                                                                                                                                                                                                                                                                                                
  first=`echo $range_cpus | awk '{print $1}'`                                                                                                                                                                                                                                                                                                              
  last=`echo $range_cpus | awk '{print $2}'`                                                                                                                                                                                                                                                                                                               
  echo "core range from" $first "to" $last                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                           
  while (($first <= $last))                                                                                                                                                                                                                                                                                                                                
  do                                                                                                                                                                                                                                                                                                                                                       
    online_cpu_file="/sys/devices/system/cpu/cpu$first/online"                                                                                                                                                                                                                                                                                             
    if [ ! -f "${online_cpu_file}" ]; then                                                                                                                                 
      echo "ERROR: ${online_cpu_file} does not exist"                                                                                                                      
      exit 1                                                                                                                                                               
    fi                                                                                                                                                                     
    echo $disable_cpu > "${online_cpu_file}"                                                                                                                                                                                                                                                                                                               
    echo "offline cpu num $first"                                                                                                                                                                                                                                                                                                                          
    ((first++))                                                                                                                                                                                                                                                                                                                                            
  done                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                           
else                                                                                                                                                                       
  cpus="$(echo $OFFLINE_CORES | grep -o -E '[0-9]+')"                                                                                                                                                                                                                                                                                                      
  for cpu in $cpus;                                                                                                                                                                                                                                                                                                                                        
  do                             
    online_cpu_file="/sys/devices/system/cpu/cpu$cpu/online"                                                                                                                                                                                                                                                                                               
    if [ ! -f "${online_cpu_file}" ]; then                                                                                                                                 
      echo "ERROR: ${online_cpu_file} does not exist"                                                                                                                      
      exit 1                                                                                                                                                               
    fi                                                                                                                                                                     
    echo $disable_cpu > "${online_cpu_file}"                                                                                                                                                                                                                                                                                                               
    echo "offline cpu num $cpu"                                                                                                                                                                                                                                                                                                                            
  done                                                                                                                                                                                                                                                                                                                                                     
fi         